# =================================================================================
# Basic Airflow & User Configuration
# =================================================================================
# Sets the user ID for the Airflow process inside the Docker container to avoid
# permission issues with mounted volumes on the host machine.
AIRFLOW_UID=1000
# Sets the initial username for the Airflow web UI's admin account.
_AIRFLOW_WWW_USER_USERNAME=airflow
# Sets the initial password for the Airflow web UI's admin account.
_AIRFLOW_WWW_USER_PASSWORD=shinhan1


# =================================================================================
# Concurrency & Parallelism Settings (Tuned for ~8 Cores, 16GB RAM)
# =================================================================================
# Sets the number of tasks a single Celery worker can execute concurrently.
# This is the "worker slot" count. A value of 4 is a safe starting point
# for an 8-core machine, leaving resources for other system processes.
AIRFLOW__CELERY__WORKER_CONCURRENCY=4       # 각 워커당 4개 태스크 처리

# Defines the maximum number of task instances that can run simultaneously
# across the entire Airflow system (all workers combined).
AIRFLOW__CORE__PARALLELISM=16

# Limits the maximum number of concurrently running tasks for any single DAG.
# This prevents one highly parallel DAG from monopolizing all available worker slots.
AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG=8

# Sets the maximum number of active DAG runs (e.g., for different execution dates)
# that can exist at the same time for a single DAG.
AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG=4


# =================================================================================
# Scheduler Performance Optimization
# =================================================================================
# The maximum number of new DAG runs the scheduler should create in a single loop.
AIRFLOW__SCHEDULER__MAX_DAGRUNS_TO_CREATE_PER_LOOP=8

# The maximum number of DAG runs the scheduler will queue for execution in one loop.
AIRFLOW__SCHEDULER__MAX_DAGRUNS_PER_LOOP_TO_SCHEDULE=4

# How often (in seconds) the scheduler scans the DAGs directory for new or modified files. (300 seconds)
AIRFLOW__SCHEDULER__DAG_DIR_LIST_INTERVAL=300

# The number of parallel processes the scheduler uses to parse DAG files.
# A value of 2 is a sensible choice for an 8-core CPU.
AIRFLOW__SCHEDULER__PARSING_PROCESSES=2

# A critical safety setting. If False, Airflow will not run historical,
# missed DAG runs when a DAG is first deployed with a past start_date. This prevents
# a "DAG run storm" that can overload the system.
AIRFLOW__SCHEDULER__CATCHUP_BY_DEFAULT=False

# The maximum time (in seconds) the scheduler will wait for a single
# DAG file to be parsed. This prevents a single slow or problematic DAG file
# from blocking the entire scheduler.
AIRFLOW__CORE__DAGBAG_IMPORT_TIMEOUT=30


# =================================================================================
# Logging and Storage Settings (Tuned for ~50GB Storage)
# =================================================================================
# Specifies the base directory where local task logs are stored inside the container.
AIRFLOW__LOGGING__BASE_LOG_FOLDER=/opt/airflow/logs

# Sets the number of days to retain log files on the local disk. Logs older
# than 14 days will be automatically deleted by the cleanup process.
AIRFLOW__LOGGING__LOG_RETENTION_DAYS=14

# Sets the default logging level for Airflow components.
AIRFLOW__LOGGING__LOGGING_LEVEL=INFO

# Compresses logs that are stored in the database (e.g., for triggerer jobs) to save space.
AIRFLOW__LOGGING__COMPRESS_SERIALIZED_LOGS=True


# =================================================================================
# Database Connection Pool Settings
# =================================================================================
# The number of database connections to keep open and ready in the connection pool.
AIRFLOW__DATABASE__SQL_ALCHEMY_POOL_SIZE=5

# The number of additional connections that can be opened beyond the pool size
# during high-demand periods.
AIRFLOW__DATABASE__SQL_ALCHEMY_MAX_OVERFLOW=10

# How often (in seconds) to recycle database connections. 3600 seconds = 1 hour.
# This prevents issues with stale connections being terminated by a firewall.
AIRFLOW__DATABASE__SQL_ALCHEMY_POOL_RECYCLE=3600


# =================================================================================
# Webserver Performance Settings
# =================================================================================
# The number of Gunicorn worker processes for the webserver.
AIRFLOW__WEBSERVER__WORKERS=2

# Timeout (in seconds) for webserver workers. Helps manage long-running requests.
AIRFLOW__WEBSERVER__WEB_SERVER_WORKER_TIMEOUT=120


# =================================================================================
# Security & General Settings
# =================================================================================
# A secret key used to encrypt and decrypt sensitive information, such as
# connection passwords stored in the metadata database.
# This should be changed to a newly generated key in a production environment.
AIRFLOW__CORE__FERNET_KEY=OkZHPVlfSW9CvqnkSxZwz8oNKhWPCJyU2vXVJbbVJ9Y=

# Sets the default timezone for the Airflow environment, ensuring that
# DAG schedules are interpreted correctly.
AIRFLOW__CORE__DEFAULT_TIMEZONE=Asia/Ho_Chi_Minh

# A setting to suppress a warning message related to metrics timers in newer Airflow versions.
AIRFLOW__METRICS__TIMER_UNIT_CONSISTENCY=True

# Disables the loading of example DAGs.
# This reduces scheduler load in a production environment.
AIRFLOW__CORE__LOAD_EXAMPLES=False

# Disables the 'Configuration' view in the UI.
# This prevents exposure of sensitive configuration details for security.
AIRFLOW__WEBSERVER__EXPOSE_CONFIG=False

# SSL 인증서 파일 경로 (컨테이너 내부 경로)
# AIRFLOW__WEBSERVER__WEB_SERVER_SSL_CERT=/opt/airflow/ssl/airflow.crt
# AIRFLOW__WEBSERVER__WEB_SERVER_SSL_KEY=/opt/airflow/ssl/airflow.key

# SSL 포트 설정 (기본값: 8080)
# SSL 활성화 시 HTTPS 포트로 변경
# AIRFLOW__WEBSERVER__WEB_SERVER_PORT=8443


# =================================================================================
# Email Settings
# =================================================================================
# AIRFLOW__SMTP__SMTP_HOST=your-internal-smtp.mycompany.com
# AIRFLOW__SMTP__SMTP_PORT=587 or 25
# AIRFLOW__SMTP__SMTP_USER=smtp_username
# AIRFLOW__SMTP__SMTP_PASSWORD=smtp_password
# AIRFLOW__SMTP__SMTP_MAIL_FROM=airflow-noreply@mycompany.com
# AIRFLOW__SMTP__SMTP_STARTTLS=True
# AIRFLOW__SMTP__SMTP_SSL=False